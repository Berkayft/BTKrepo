<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Slide Generator</title>
    <style></style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.6.7/axios.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div class="bg-gray-100">
    <div class="header bg-white h-16 px-10 py-8 border-b-2 border-gray-200 flex items-center justify-between">
        <div class="flex items-center space-x-2 text-gray-400">
            <a href="/" class="text-green-700 tracking-wider font-thin text-md">
                <img src="backSign.svg" alt="Profile Photo" class="w-12 h-12 object-cover rounded-full transition-transform duration-200 ease-in-out hover:scale-110 shadow-lg">
            </a>
        </div>
    </div>
    <div class="header my-3 h-12 px-10 flex items-center justify-between">
        <h1 class="font-medium text-2xl">Slide Generator</h1>
    </div>
    <div class="flex flex-col mx-3 mt-6 lg:flex-row">
        <div class="w-full lg:w-1/3 m-1">
            <form id="uploadForm" class="w-full bg-white shadow-md p-6">
                <div class="flex flex-wrap -mx-3 mb-6">
                    <div class="w-full md:w-full px-3 mb-6">
                        <label class="block uppercase tracking-wide text-gray-700 text-sm font-bold mb-2" for="slide_name">Slide Name</label>
                        <input class="appearance-none block w-full bg-white text-gray-900 font-medium border border-gray-400 rounded-lg py-3 px-3 leading-tight focus:outline-none focus:border-[#98c01d]" type="text" name="name" placeholder="Name" required />
                    </div>
                    <div class="w-full px-3 mb-6">
                        <label class="block uppercase tracking-wide text-gray-700 text-sm font-bold mb-2" for="slide_description">Slide Description</label>
                        <textarea rows="6" class="appearance-none block w-full bg-white text-gray-900 font-medium border border-gray-400 rounded-lg py-3 px-3 leading-tight focus:outline-none focus:border-[#98c01d]" name="description"  placeholder="Description..." required></textarea>
                    </div>
                    <div class="w-full px-3 mb-8">
                        <label class="mx-auto cursor-pointer flex w-full max-w-lg flex-col items-center justify-center rounded-xl border-2 border-dashed border-green-400 bg-white p-6 text-center" for="pdfFile">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-10 w-10 text-green-800" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" />
                            </svg>
                            <h2 class="mt-4 text-xl font-medium text-gray-700 tracking-wide">Your PDF</h2>
                            <p id="fileName" class="mt-2 text-gray-500 tracking-wide">Upload or drag & drop your PDF file.</p>
                            <input id="pdfFile" type="file" class="hidden" accept=".pdf" required />
                        </label>
                    </div>
                    <div class="w-full md:w-full px-3 mb-6">
                        <button type="submit" class="appearance-none block w-full bg-green-600 text-gray-100 font-bold border border-gray-200 rounded-lg py-3 px-3 leading-tight hover:bg-green-600 focus:outline-none">Add Category</button>
                    </div>
                    <div id="message" class="w-full text-center mt-4"></div>
                </div>
            </form>
        </div>
        
        <div class="w-full lg:w-2/3 m-1 bg-white shadow-lg text-lg rounded-sm border border-gray-200">
            <div class="overflow-x-auto rounded-lg p-3">
                <table class="table-auto w-full">
                    <thead class="text-sm font-semibold uppercase text-gray-800 bg-gray-50">
                        <tr>
                            <th>Index</th>
                            <th>Slide Name</th>
                            <th class="text-left">Topic</th>
                            <th class="text-center">Action</th>
                        </tr>
                    </thead>
                    <tbody id="fileList"></tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    const fileInput = document.getElementById('pdfFile');
    const fileNameDisplay = document.getElementById('fileName');
    const messageDiv = document.getElementById('message');
    
    fileInput.addEventListener('change', () => {
        if (fileInput.files.length > 0) {
            fileNameDisplay.textContent = fileInput.files[0].name;
        } else {
            fileNameDisplay.textContent = "Upload or drag & drop your PDF file.";
        }
    });

    document.getElementById('uploadForm').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    if (!fileInput.files[0]) {
        messageDiv.innerHTML = '<p class="text-red-600">Please select a file.</p>';
        return;
    }

    const formData = new FormData();
    formData.append('pdf', fileInput.files[0]);
    formData.append('name', document.querySelector('input[name="name"]').value); // Add slide name
    formData.append('description', document.querySelector('textarea[name="description"]').value); // Add slide description

    try {
        const response = await axios.post('/slide/upload', formData, {
            headers: { 'Content-Type': 'multipart/form-data' }
        });

        if (response.status === 200) {
            messageDiv.innerHTML = '<p class="text-green-600">File uploaded successfully.</p>';
            loadFileList();
        } else {
            messageDiv.innerHTML = `<p class="text-red-600">${response.data.error}</p>`;
        }
    } catch (error) {
        messageDiv.innerHTML = '<p class="text-red-600">Error uploading file.</p>';
    }

    fileInput.value = '';
    fileNameDisplay.textContent = "Upload or drag & drop your PDF file.";
    });

    async function loadFileList() {
        const fileListDiv = document.getElementById('fileList');

        try {
            const response = await axios.get('/slide/files');
            const files = response.data;

            fileListDiv.innerHTML = files.map((file, index) => `
                <tr>
                    <td class="p-2 text-center">${index + 1}</td>
                    <td class="p-2">${file.name}</td>
                    <td class="p-2 text-left">${file.description}</td>
                    <td class="p-2 text-center">
                        <a href="/download/${file.filename}" class="text-green-600 hover:text-green-800">Download</a>
                    </td>
                </tr>
            `).join('');
        } catch (error) {
            fileListDiv.innerHTML = '<tr><td colspan="4" class="p-4 text-center text-red-600">Error loading file list.</td></tr>';
        }
    }

    loadFileList();
</script>
</body>
</html>
